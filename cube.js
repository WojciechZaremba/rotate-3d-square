const canvas = document.querySelector('#canvas');
const ctx = canvas.getContext('2d');
canvas.width = document.body.clientWidth;
canvas.height = document.body.clientHeight; // use this instead of stretching it in CSS

let screenY = canvas.height
let screenX = canvas.width
// let ratio = screenX/screenY
// unused

let midX = screenX/2
let midY = screenY/2

// maybe those will be modifiable in the future:
let edgeLen = 80
let mSens = 1
let fog = -.3
let hue = 55

/////////// CUBE ///////////
const cube = {
    vertices: {
        0: [-1,-1,-1],
        1: [-1, 1,-1],
        2: [ 1, 1,-1],
        3: [ 1,-1,-1],
        4: [-1,-1, 1],
        5: [-1, 1, 1],
        6: [ 1, 1, 1],
        7: [ 1,-1, 1],
    },
    edges: {
        0: [0,1],
        1: [0,3],
        2: [0,4],
        3: [2,1],
        4: [2,3],
        5: [2,6],
        6: [5,1],
        7: [5,4],
        8: [5,6],
        9: [7,3],
        10: [7,4],
        11: [7,6],
    }
}

///////// PIRAMIDE /////////
const piramideFaceHeight = Math.sqrt(Math.pow(2,2) - Math.pow(1,2))
const piramideHeight = Math.sqrt(Math.pow(2,2) - Math.pow(piramideFaceHeight*2/3,2))
const piramide = {
    vertices: {
        0: [-1,
            -piramideFaceHeight / 3,
            -piramideHeight / 3],
        1: [ 0, 
            piramideFaceHeight * 2 / 3,
            -piramideHeight / 3],
        2: [ 1, 
            -piramideFaceHeight / 3,
            -piramideHeight / 3],
        3: [ 0, 0, piramideHeight * 2 / 3],
    },
    edges: {
        0: [0,1],
        1: [0,2],
        2: [0,3],
        3: [1,2],
        4: [1,3],
        5: [2,3],
    }
}

/////////// PAPER //////////
const paper = {vertices: {}, edges: {}}
let meridians = 4 // don't touch
let longitudes = 5 // don't touch (can't be 2)
let wrinkle = {x: 1, y: 1}
let paperCorner = [0 - (longitudes - 2) / 2, meridians / 2]
let paperEdges = meridians * (longitudes - 1) + longitudes * (meridians - 1)

for (let i = 0; i < longitudes; i++) {
    for (let j = 0; j < meridians; j++) {
        let x = paperCorner[0]
        let y = paperCorner[1]
        paper.vertices[j + i * meridians] = [x, y, Math.random() / 1.5]
        paperCorner[0] += wrinkle.x
    }
    paperCorner[0] = -1.5 // fix it
    paperCorner[1] -= wrinkle.y
}
for (let i = 0, v = 0; i < paperEdges; i++) {
    if ((v + 1) % (longitudes - 1) != 0) {
        paper.edges[i] = [v, v + 1]
    } else {
        i--
    }
    if (v <= meridians * longitudes - longitudes) {
        paper.edges[++i] = [v, v + longitudes - 1]
    }
    v++
}

/////////// EARTH //////////
const earth = JSON.parse('{"vertices":{"0":[0.0,0.0,-1.0],"1":[0.7236073017120361,-0.5257253050804138,-0.44721952080726624],"2":[-0.276388019323349,-0.8506492376327515,-0.4472198486328125],"3":[-0.8944262266159058,0.0,-0.44721561670303345],"4":[-0.276388019323349,0.8506492376327515,-0.4472198486328125],"5":[0.7236073017120361,0.5257253050804138,-0.44721952080726624],"6":[0.276388019323349,-0.8506492376327515,0.4472198486328125],"7":[-0.7236073017120361,-0.5257253050804138,0.44721952080726624],"8":[-0.7236073017120361,0.5257253050804138,0.44721952080726624],"9":[0.276388019323349,0.8506492376327515,0.4472198486328125],"10":[0.8944262266159058,0.0,0.44721561670303345],"11":[0.0,0.0,1.0],"12":[-0.16245555877685547,-0.49999526143074036,-0.8506544232368469],"13":[0.42532268166542053,-0.30901139974594116,-0.8506541848182678],"14":[0.26286882162094116,-0.8090116381645203,-0.5257376432418823],"15":[0.8506478667259216,0.0,-0.5257359147071838],"16":[0.42532268166542053,0.30901139974594116,-0.8506541848182678],"17":[-0.525729775428772,0.0,-0.8506516814231873],"18":[-0.6881893873214722,-0.49999693036079407,-0.5257362127304077],"19":[-0.16245555877685547,0.49999526143074036,-0.8506544232368469],"20":[-0.6881893873214722,0.49999693036079407,-0.5257362127304077],"21":[0.26286882162094116,0.8090116381645203,-0.5257376432418823],"22":[0.9510578513145447,-0.30901262164115906,0.0],"23":[0.9510578513145447,0.30901262164115906,0.0],"24":[0.0,-0.9999999403953552,0.0],"25":[0.5877856016159058,-0.8090167045593262,0.0],"26":[-0.9510578513145447,-0.30901262164115906,0.0],"27":[-0.5877856016159058,-0.8090167045593262,0.0],"28":[-0.5877856016159058,0.8090167045593262,0.0],"29":[-0.9510578513145447,0.30901262164115906,0.0],"30":[0.5877856016159058,0.8090167045593262,0.0],"31":[0.0,0.9999999403953552,0.0],"32":[0.6881893873214722,-0.49999693036079407,0.5257362127304077],"33":[-0.26286882162094116,-0.8090116381645203,0.5257376432418823],"34":[-0.8506478667259216,0.0,0.5257359147071838],"35":[-0.26286882162094116,0.8090116381645203,0.5257376432418823],"36":[0.6881893873214722,0.49999693036079407,0.5257362127304077],"37":[0.16245555877685547,-0.49999526143074036,0.8506543636322021],"38":[0.525729775428772,0.0,0.8506516814231873],"39":[-0.42532268166542053,-0.30901139974594116,0.8506541848182678],"40":[-0.42532268166542053,0.30901139974594116,0.8506541848182678],"41":[0.16245555877685547,0.49999526143074036,0.8506543636322021]},"edges":{"0":[12,0],"1":[13,1],"2":[14,2],"3":[15,1],"4":[16,5],"5":[17,0],"6":[18,3],"7":[19,0],"8":[20,4],"9":[21,5],"10":[22,1],"11":[23,10],"12":[24,2],"13":[25,6],"14":[26,3],"15":[27,7],"16":[28,4],"17":[29,8],"18":[30,5],"19":[31,9],"20":[32,6],"21":[33,7],"22":[34,8],"23":[35,9],"24":[36,10],"25":[37,6],"26":[38,11],"27":[39,7],"28":[40,8],"29":[41,9],"30":[2,12],"31":[0,13],"32":[1,14],"33":[5,15],"34":[0,16],"35":[3,17],"36":[2,18],"37":[4,19],"38":[3,20],"39":[4,21],"40":[10,22],"41":[5,23],"42":[6,24],"43":[1,25],"44":[7,26],"45":[2,27],"46":[8,28],"47":[3,29],"48":[9,30],"49":[4,31],"50":[10,32],"51":[6,33],"52":[7,34],"53":[8,35],"54":[9,36],"55":[11,37],"56":[10,38],"57":[11,39],"58":[11,40],"59":[11,41],"60":[38,41],"61":[38,36],"62":[41,36],"63":[41,40],"64":[41,35],"65":[40,35],"66":[40,39],"67":[40,34],"68":[39,34],"69":[39,37],"70":[39,33],"71":[37,33],"72":[37,38],"73":[37,32],"74":[38,32],"75":[23,36],"76":[23,30],"77":[36,30],"78":[31,35],"79":[31,28],"80":[35,28],"81":[29,34],"82":[29,26],"83":[34,26],"84":[27,33],"85":[27,24],"86":[33,24],"87":[25,32],"88":[25,22],"89":[32,22],"90":[30,31],"91":[30,21],"92":[31,21],"93":[28,29],"94":[28,20],"95":[29,20],"96":[26,27],"97":[26,18],"98":[27,18],"99":[24,25],"100":[24,14],"101":[25,14],"102":[22,23],"103":[22,15],"104":[23,15],"105":[16,21],"106":[16,19],"107":[21,19],"108":[19,20],"109":[19,17],"110":[20,17],"111":[17,18],"112":[17,12],"113":[18,12],"114":[15,16],"115":[15,13],"116":[16,13],"117":[12,14],"118":[12,13],"119":[14,13]}}')


const head = JSON.parse('{"vertices":{"0":[2.3957581520080566,-0.780116856098175,-1.1095556020736694],"1":[-1.2331764698028564,-0.17725145816802979,0.06363051384687424],"2":[-0.7679526805877686,-0.17725145816802979,0.851908266544342],"3":[-0.8393338918685913,-0.3654315173625946,1.134505033493042],"4":[-0.4580620527267456,-0.5001097321510315,2.1181459426879883],"5":[-0.8939858675003052,-0.15374703705310822,-0.2390449196100235],"6":[-0.6018404960632324,-0.33550575375556946,0.7140213847160339],"7":[-0.7380274534225464,-0.36147457361221313,-0.05999201536178589],"8":[-0.07756227254867554,-1.2144756317138672,0.6395569443702698],"9":[-0.3867514431476593,-0.9967739582061768,1.024193286895752],"10":[-0.2785587012767792,-1.0643894672393799,0.05609646439552307],"11":[-0.9874483346939087,-0.20599815249443054,-0.4018171727657318],"12":[-0.8870667219161987,-0.214278444647789,-0.5884159803390503],"13":[-0.9662280082702637,-0.18641483783721924,-0.7340205907821655],"14":[-0.6281357407569885,-0.5066250562667847,-0.6923579573631287],"15":[-0.4414512813091278,-0.8016442656517029,-0.6037088632583618],"16":[-0.8104831576347351,-0.16953466832637787,-0.9120944738388062],"17":[-0.8456077575683594,-0.17387384176254272,-1.325593113899231],"18":[-0.5989977121353149,-0.37175115942955017,-1.3494839668273926],"19":[-0.07102333009243011,-1.121373176574707,1.8193540573120117],"20":[0.899424135684967,-0.6860988736152649,2.6017050743103027],"21":[1.0346239805221558,-1.2555979490280151,2.2263948917388916],"22":[1.011894702911377,-1.3507835865020752,0.626118540763855],"23":[-0.26842278242111206,-0.5319252610206604,-1.3152505159378052],"24":[0.2213590145111084,-0.867348849773407,-0.9430978894233704],"25":[0.4782902002334595,-1.151507019996643,-0.46132999658584595],"26":[-0.6714658141136169,-0.13472628593444824,-1.4351977109909058],"27":[-0.37447792291641235,-0.18481886386871338,-1.4484409093856812],"28":[2.308793544769287,-0.3881929814815521,1.952919840812683],"29":[2.3021414279937744,-0.6979972124099731,1.6563849449157715],"30":[2.4172115325927734,-0.6979972124099731,0.6687838435173035],"31":[2.014362096786499,-0.6979972124099731,-0.06132740527391434],"32":[1.4475538730621338,-0.7836891412734985,-0.17112824320793152],"33":[0.8801677227020264,-0.925962507724762,-0.5726351141929626],"34":[0.7364379167556763,-0.8274204134941101,-0.891762912273407],"35":[0.4188309609889984,-0.48971039056777954,-1.2327414751052856],"36":[0.2864468991756439,-0.2936455011367798,-1.3170326948165894],"37":[1.830030918121338,-0.8699609041213989,-1.2259998321533203],"38":[1.2584136724472046,-1.0119943618774414,-1.6224809885025024],"39":[1.0921730995178223,-0.9001767635345459,-2.0702524185180664],"40":[0.7380743622779846,-0.5258621573448181,-2.3963279724121094],"41":[0.6215515732765198,-0.3206580877304077,-2.579885244369507],"42":[2.3957581520080566,0.780116856098175,-1.1095556020736694],"43":[-1.2331764698028564,0.17725145816802979,0.06363051384687424],"44":[-0.7679526805877686,0.17725145816802979,0.851908266544342],"45":[-0.8393338918685913,0.3654315173625946,1.134505033493042],"46":[-0.4580620527267456,0.5001097321510315,2.1181459426879883],"47":[-0.8939858675003052,0.15374703705310822,-0.2390449196100235],"48":[-0.6018404960632324,0.33550575375556946,0.7140213847160339],"49":[-0.7380274534225464,0.36147457361221313,-0.05999201536178589],"50":[-0.07756227254867554,1.2144756317138672,0.6395569443702698],"51":[-0.3867514431476593,0.9967739582061768,1.024193286895752],"52":[-0.2785587012767792,1.0643894672393799,0.05609646439552307],"53":[-0.9874483346939087,0.20599815249443054,-0.4018171727657318],"54":[-0.8870667219161987,0.214278444647789,-0.5884159803390503],"55":[-0.9662280082702637,0.18641483783721924,-0.7340205907821655],"56":[-0.6281357407569885,0.5066250562667847,-0.6923579573631287],"57":[-0.4414512813091278,0.8016442656517029,-0.6037088632583618],"58":[-0.8104831576347351,0.16953466832637787,-0.9120944738388062],"59":[-0.8456077575683594,0.17387384176254272,-1.325593113899231],"60":[-0.5989977121353149,0.37175115942955017,-1.3494839668273926],"61":[-0.07102333009243011,1.121373176574707,1.8193540573120117],"62":[0.899424135684967,0.6860988736152649,2.6017050743103027],"63":[1.0346239805221558,1.2555979490280151,2.2263948917388916],"64":[1.011894702911377,1.3507835865020752,0.626118540763855],"65":[-0.26842278242111206,0.5319252610206604,-1.3152505159378052],"66":[0.2213590145111084,0.867348849773407,-0.9430978894233704],"67":[0.4782902002334595,1.151507019996643,-0.46132999658584595],"68":[-0.6714658141136169,0.13472628593444824,-1.4351977109909058],"69":[-0.37447792291641235,0.18481886386871338,-1.4484409093856812],"70":[2.308793544769287,0.3881929814815521,1.952919840812683],"71":[2.3021414279937744,0.6979972124099731,1.6563849449157715],"72":[2.4172115325927734,0.6979972124099731,0.6687838435173035],"73":[2.014362096786499,0.6979972124099731,-0.06132740527391434],"74":[1.4475538730621338,0.7836891412734985,-0.17112824320793152],"75":[0.8801677227020264,0.925962507724762,-0.5726351141929626],"76":[0.7364379167556763,0.8274204134941101,-0.891762912273407],"77":[0.4188309609889984,0.48971039056777954,-1.2327414751052856],"78":[0.2864468991756439,0.2936455011367798,-1.3170326948165894],"79":[1.830030918121338,0.8699609041213989,-1.2259998321533203],"80":[1.2584136724472046,1.0119943618774414,-1.6224809885025024],"81":[1.0921730995178223,0.9001767635345459,-2.0702524185180664],"82":[0.7380743622779846,0.5258621573448181,-2.3963279724121094],"83":[0.6215515732765198,0.3206580877304077,-2.579885244369507],"84":[-0.8393338918685913,0.0,1.134505033493042],"85":[2.6575112342834473,0.0,0.7011273503303528],"86":[-0.4580620229244232,0.0,2.164522409439087],"87":[0.899424135684967,0.0,2.6658244132995605],"88":[2.3680272102355957,0.0,2.0223841667175293],"89":[2.3106160163879395,0.0,-0.23793113231658936],"90":[0.6153318881988525,0.0,-2.579885244369507],"91":[2.727358341217041,0.0,-1.2928028106689453],"92":[0.2864468991756439,0.0,-1.3212465047836304],"93":[-0.3804931044578552,0.0,-1.462647795677185],"94":[-0.8456077575683594,0.0,-1.325593113899231],"95":[-0.8104831576347351,0.0,-0.9120944738388062],"96":[-0.9662280082702637,0.0,-0.7340205907821655],"97":[-0.8870667219161987,0.0,-0.5884159803390503],"98":[-0.9741331338882446,0.0,-0.4563617706298828],"99":[-0.8583328723907471,0.0,-0.2504265308380127],"100":[-1.0974745750427246,0.0,-0.17847301065921783],"101":[-1.2331764698028564,0.0,0.06363056600093842],"102":[-0.7679526805877686,0.0,0.8519082069396973],"103":[-0.6714658141136169,0.0,-1.4351977109909058]},"edges":{"0":[86,84],"1":[89,85],"2":[88,87],"3":[87,86],"4":[85,88],"5":[39,40],"6":[38,39],"7":[37,38],"8":[0,37],"9":[93,92],"10":[103,93],"11":[95,94],"12":[96,95],"13":[97,96],"14":[98,97],"15":[99,98],"16":[100,99],"17":[101,100],"18":[102,101],"19":[84,102],"20":[2,1],"21":[1,101],"22":[102,2],"23":[84,3],"24":[2,3],"25":[86,4],"26":[3,4],"27":[100,1],"28":[99,5],"29":[100,5],"30":[2,6],"31":[1,7],"32":[5,7],"33":[6,7],"34":[6,8],"35":[8,9],"36":[3,9],"37":[7,10],"38":[8,10],"39":[98,11],"40":[5,11],"41":[97,12],"42":[11,12],"43":[96,13],"44":[12,13],"45":[12,14],"46":[11,14],"47":[13,14],"48":[7,14],"49":[10,15],"50":[14,15],"51":[95,16],"52":[13,16],"53":[14,16],"54":[94,17],"55":[16,17],"56":[17,18],"57":[16,18],"58":[15,18],"59":[9,19],"60":[4,19],"61":[87,20],"62":[4,20],"63":[19,21],"64":[20,21],"65":[21,22],"66":[8,22],"67":[18,23],"68":[15,24],"69":[23,24],"70":[24,25],"71":[10,25],"72":[22,25],"73":[94,103],"74":[103,26],"75":[17,26],"76":[18,26],"77":[26,27],"78":[93,27],"79":[23,27],"80":[88,28],"81":[20,28],"82":[28,29],"83":[21,29],"84":[29,30],"85":[22,29],"86":[30,22],"87":[30,31],"88":[22,32],"89":[31,32],"90":[32,33],"91":[25,33],"92":[33,34],"93":[24,34],"94":[34,35],"95":[23,35],"96":[92,36],"97":[27,36],"98":[35,36],"99":[85,30],"100":[89,31],"101":[90,41],"102":[40,41],"103":[91,0],"104":[91,89],"105":[31,0],"106":[40,35],"107":[36,41],"108":[92,90],"109":[39,34],"110":[38,33],"111":[37,32],"112":[81,82],"113":[80,81],"114":[79,80],"115":[42,79],"116":[44,43],"117":[43,101],"118":[102,44],"119":[84,45],"120":[44,45],"121":[86,46],"122":[45,46],"123":[100,43],"124":[99,47],"125":[100,47],"126":[44,48],"127":[43,49],"128":[47,49],"129":[48,49],"130":[48,50],"131":[50,51],"132":[45,51],"133":[49,52],"134":[50,52],"135":[98,53],"136":[47,53],"137":[97,54],"138":[53,54],"139":[96,55],"140":[54,55],"141":[54,56],"142":[53,56],"143":[55,56],"144":[49,56],"145":[52,57],"146":[56,57],"147":[95,58],"148":[55,58],"149":[56,58],"150":[94,59],"151":[58,59],"152":[59,60],"153":[58,60],"154":[57,60],"155":[51,61],"156":[46,61],"157":[87,62],"158":[46,62],"159":[61,63],"160":[62,63],"161":[63,64],"162":[50,64],"163":[60,65],"164":[57,66],"165":[65,66],"166":[66,67],"167":[52,67],"168":[64,67],"169":[103,68],"170":[59,68],"171":[60,68],"172":[68,69],"173":[93,69],"174":[65,69],"175":[88,70],"176":[62,70],"177":[70,71],"178":[63,71],"179":[71,72],"180":[64,71],"181":[72,64],"182":[72,73],"183":[64,74],"184":[73,74],"185":[74,75],"186":[67,75],"187":[75,76],"188":[66,76],"189":[76,77],"190":[65,77],"191":[92,78],"192":[69,78],"193":[77,78],"194":[85,72],"195":[89,73],"196":[90,83],"197":[82,83],"198":[91,42],"199":[73,42],"200":[82,77],"201":[78,83],"202":[81,76],"203":[80,75],"204":[79,74]}}')

let figure = paper

let verts = figure.vertices
let edges = figure.edges
let vertsKeys = Object.keys(verts)
let edgeKeys = Object.keys(edges)

function rotateX(theta) {
    const sinTheta = Math.sin(-theta)
    const cosTheta = Math.cos(-theta)

    for (let key of vertsKeys) {
        let vertex = verts[key]
        let y = vertex[1]
        let z = vertex[2]
        
        vertex[1] = y * cosTheta + z * sinTheta
        vertex[2] = z * cosTheta - y * sinTheta
    }
}

function rotateY(theta) {
    const sinTheta = Math.sin(-theta)
    const cosTheta = Math.cos(-theta)

    for (let key of vertsKeys) {
        let vertex = verts[key]
        let x = vertex[0]
        let z = vertex[2]

        vertex[0] = x * cosTheta + z * sinTheta
        vertex[2] = z * cosTheta - x * sinTheta
    }
}

function rotateZ(theta) {
    const sinTheta = Math.sin(theta)
    const cosTheta = Math.cos(theta)

    for (let key of vertsKeys) {
        let vertex = verts[key]
        let x = vertex[0]
        let y = vertex[1]

        vertex[0] = x * cosTheta + y * sinTheta
        vertex[1] = y * cosTheta - x * sinTheta
    }
}


function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    ctx.lineWidth = 4
    for (let key of edgeKeys) {
        let fro = {
            x: verts[edges[key][0]][0],
            y: verts[edges[key][0]][1],
            z: verts[edges[key][0]][2]
        }
        let to = {
            x: verts[edges[key][1]][0],
            y: verts[edges[key][1]][1],
            z: verts[edges[key][1]][2]
        }
        
        fro.x = fro.x * edgeLen + midX
        fro.y = fro.y * edgeLen + midY
        to.x = to.x * edgeLen + midX
        to.y = to.y * edgeLen + midY
        
        let grad = ctx.createLinearGradient(fro.x, fro.y, to.x, to.y)

        let fogFro = (fro.z + 2) / 2 + fog
        let fogTo = (to.z + 2) / 2 + fog
        grad.addColorStop(0, `rgba(${hue},${hue},${hue},${fogFro})`);
        grad.addColorStop(1, `rgba(${hue},${hue},${hue},${fogTo})`);
        ctx.strokeStyle = grad

        ctx.beginPath()
        ctx.moveTo(fro.x, fro.y)
        ctx.lineTo(to.x, to.y)
        ctx.closePath()
        ctx.stroke()
    }
}

rotateX(.9)
rotateY(.3)
rotateZ(-.1)
draw()

let mousePos = [0,0]

function moveListener(e) {
    rotateY((mousePos[0]-e.offsetX)/200*mSens)
    rotateX((mousePos[1]-e.offsetY)/200*mSens)
    
    mousePos[0] = e.offsetX
    mousePos[1] = e.offsetY

    draw()
}

document.addEventListener("mousedown", (e) => {
    mousePos[0] = e.offsetX
    mousePos[1] = e.offsetY
    document.addEventListener("mousemove", moveListener)
    document.querySelector("body").style.cursor = "grab";
})
document.addEventListener("mouseup", () => {
    document.removeEventListener("mousemove", moveListener)
    document.querySelector("body").style.cursor = "pointer";
})

window.onresize = () => {
    canvas.width = document.body.clientWidth;
    canvas.height = document.body.clientHeight;

    screenY = canvas.height
    screenX = canvas.width
    ratio = screenX/screenY

    midX = screenX/2
    midY = screenY/2

    draw()
}